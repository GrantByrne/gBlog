@page "/admin/CreatePost"
@using Blog.Web.Pages.Shared
@using Blog.Web.Database
@using Blog.Web.Models
@layout AdminLayout

<h3>Create a New Post</h3>

<div class="form-group">
    <label for="title">Title</label>
    <input type="text" class="form-control" id="title" @bind="_post.Title"/>
</div>
<div class="form-group">
    <label for="publish-date-time">Publish Date Time</label>
    <input type="datetime-local" class="form-control" id="publish-date-time" @bind="_post.Created"/>
</div>
<div class="form-group mt-3">
    <label for="post-body">Post Body</label>
    <textarea class="form-control" id="post-body" rows="10" @bind="_post.Content"></textarea>
</div>
<div class="form-group mt-3">
    <button class="btn btn-primary float-end" @onclick="Save">Save</button>
</div>


@code {

    private Post _post = new()
    {
        Created = DateTime.Now
    };

    [Inject]
    public BlogDbContext DbContext { get; set; } = null!;
    
    [Inject]
    public NavigationManager NavigationManager { get; set; } = null!;

    public void Save()
    {
        try
        {
            DbContext.Posts.Add(_post);
            DbContext.SaveChanges();
            
            NavigationManager.NavigateTo("/admin/posts");
        }
        catch (Exception ex)
        {
    // Ignore
        }
    }

}